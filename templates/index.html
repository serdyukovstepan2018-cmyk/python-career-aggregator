<!DOCTYPE html>
<html>
  <head>
    <title>Python –í–∞–∫–∞–Ω—Å–∏–∏</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .header {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      }
      .stats {
        display: flex;
        gap: 15px;
        margin: 20px 0;
      }
      .stat {
        background: white;
        padding: 20px;
        border-radius: 8px;
        flex: 1;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .card {
        background: white;
        padding: 20px;
        margin: 10px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .tech-list {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      input[type="text"] {
        padding: 10px;
        width: 300px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      button {
        padding: 10px 20px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .vacancy {
        border: 1px solid #e0e0e0;
        padding: 15px;
        margin: 10px 0;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Python –í–∞–∫–∞–Ω—Å–∏–∏</h1>
        <p>–ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –≤–∞–∫–∞–Ω—Å–∏–π –¥–ª—è Python-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</p>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div id="statsSection">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div class="stats" id="stats">
          <!-- –ó–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>

      <!-- –ü–æ–∏—Å–∫ -->
      <div class="card">
        <h2>üîç –ü–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π</h2>
        <input
          type="text"
          id="searchInput"
          placeholder="–í–≤–µ–¥–∏—Ç–µ Python, Django, FastAPI..."
        />
        <button onclick="searchVacancies()">–ù–∞–π—Ç–∏ –≤–∞–∫–∞–Ω—Å–∏–∏</button>
        <div id="searchResults" style="margin-top: 20px"></div>
      </div>

      <!-- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∫–æ–º–ø–∞–Ω–∏–∏ -->
      <div class="tech-list">
        <div class="card">
          <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</h2>
          <div id="techList">
            <!-- –°–ø–∏—Å–æ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π -->
          </div>
        </div>

        <div class="card">
          <h2>üèÜ –¢–æ–ø –∫–æ–º–ø–∞–Ω–∏–π</h2>
          <div id="companiesList">
            <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.addEventListener("DOMContentLoaded", loadStats);

      async function loadStats() {
        try {
          const response = await fetch("/stats");
          const data = await response.json();

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          document.getElementById("stats").innerHTML = `
                    <div class="stat">
                        <h3>–í—Å–µ–≥–æ –≤–∞–∫–∞–Ω—Å–∏–π</h3>
                        <h2>${data.total_vacancies}</h2>
                    </div>
                    <div class="stat">
                        <h3>–° –∑–∞—Ä–ø–ª–∞—Ç–æ–π</h3>
                        <h2>${data.with_salary}</h2>
                    </div>
                    <div class="stat">
                        <h3>–¢–æ–ø –∫–æ–º–ø–∞–Ω–∏—è</h3>
                        <h4>${
                          data.top_companies[0]
                            ? data.top_companies[0].company
                            : "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
                        }</h4>
                    </div>
                `;

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
          showTechnologies(data.top_technologies);
          showCompanies(data.top_companies);
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:", error);
        }
      }

      function showTechnologies(techs) {
        const techList = document.getElementById("techList");
        if (techs.length === 0) {
          techList.innerHTML = "<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö</p>";
          return;
        }

        techList.innerHTML = techs
          .map(
            (tech) =>
              `<p><strong>${tech.tech}</strong>: ${tech.count} –≤–∞–∫–∞–Ω—Å–∏–π</p>`
          )
          .join("");
      }

      function showCompanies(companies) {
        const companiesList = document.getElementById("companiesList");
        if (companies.length === 0) {
          companiesList.innerHTML = "<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–º–ø–∞–Ω–∏—è—Ö</p>";
          return;
        }

        companiesList.innerHTML = companies
          .map(
            (company) =>
              `<p><strong>${company.company}</strong>: ${company.count} –≤–∞–∫–∞–Ω—Å–∏–π</p>`
          )
          .join("");
      }

      async function searchVacancies() {
        const query = document.getElementById("searchInput").value;
        if (!query) {
          alert("–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å");
          return;
        }

        try {
          const response = await fetch(
            `/search?q=${encodeURIComponent(query)}`
          );
          const vacancies = await response.json();

          const resultsDiv = document.getElementById("searchResults");

          if (vacancies.length === 0) {
            resultsDiv.innerHTML = "<p>–í–∞–∫–∞–Ω—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>";
            return;
          }

          resultsDiv.innerHTML = `
                    <h3>–ù–∞–π–¥–µ–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–π: ${vacancies.length}</h3>
                    ${vacancies
                      .map(
                        (v) => `
                        <div class="vacancy">
                            <h4>${v.title}</h4>
                            <p><strong>–ö–æ–º–ø–∞–Ω–∏—è:</strong> ${v.company}</p>
                            <p><strong>–ó–∞—Ä–ø–ª–∞—Ç–∞:</strong> ${
                              v.salary || "–ù–µ —É–∫–∞–∑–∞–Ω–∞"
                            }</p>
                            <a href="${
                              v.link
                            }" target="_blank"> –û—Ç–∫—Ä—ã—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</a>
                        </div>
                    `
                      )
                      .join("")}
                `;
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:", error);
          document.getElementById("searchResults").innerHTML =
            "<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ</p>";
        }
      }
    </script>
  </body>
</html>
